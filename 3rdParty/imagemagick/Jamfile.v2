###############################################################################
## Main BJam makefile for imageMagick library
###############################################################################

import path ;


###############################################################################
# Global project requirements
###############################################################################

project
	: requirements
		<include>.
		<include>config
		<include>ltdl
		<include>ltdl/libltdl
		# disabling warning as error as we are not responsible for this code
		<warnings-as-errors>off
		<warnings>off

		<cflags>-std=gnu99

		<define>QUANTUM_DEPTH=16
		<define>LTDL
		<define>LTDLOPEN='libltdl'

		[ evaluate-if-header-is-available <define>HAVE_ARGZ_H : /usr/include/argz.h ]
		[ evaluate-if-header-is-available <define>HAVE_DIRENT_H : /usr/include/dirent.h ]

		[ evaluate-if-header-is-available <define>FREETYPE_DELEGATE : /usr/include/freetype2/freetype/freetype.h,$(3RD_PARTY)/freetype/include/freetype/freetype.h ]
		[ evaluate-if-header-is-available <define>OPENEXR_DELEGATE : /usr/include/OpenEXR/ImfVersion.h,$(3RD_PARTY)/openexr/IlmImf/ImfVersion.h ]
		[ evaluate-if-header-is-available <define>PNG_DELEGATE : /usr/include/png.h,$(3RD_PARTY)/libpng/png.h ]
		[ evaluate-if-header-is-available <define>TIFF_DELEGATE : /usr/include/tiff.h,$(3RD_PARTY)/libtiff/libtiff/tiff.h ]
		[ evaluate-if-header-is-available <define>BZLIB_DELEGATE : /usr/include/bzlib.h,$(3RD_PARTY)/bzlib/bzlib.h ]
		[ evaluate-if-header-is-available <define>ZLIB_DELEGATE : /usr/include/zlib.h,$(3RD_PARTY)/zlib/zlib.h ]

		<link>static
	: usage-requirements
		<include>.
	: build-dir $(BUILD)/3rdParty/imagemagick
    ;

###############################################################################
# imagemagick library
###############################################################################
alias	headers		: [ glob-tree *.h ] ;

lib ltdl :
	  [ glob
		 ltdl/loaders/preopen.c
		 ltdl/lt__alloc.c
		 ltdl/lt_dlloader.c
		 ltdl/lt_error.c
		 ltdl/ltdl.c
		 ltdl/slist.c
	  ]

;

lib	imagemagick	:
			  [ glob magick/*.c
				 coders/*.c
				 filters/analyze.c
			  ]
			/project-config//jasper
			/project-config//freetype
			/project-config//jpeg
			/project-config//libtiff
			/project-config//libpng
			/project-config//lcms2
			/project-config//openexr
			/project-config//libxml
			/project-config//zlib
			/project-config//bzlib
			ltdl
			;

install dist
	:
		imagemagick
	:
		<variant>debug:<location>$(DIST_DEBUG)/lib
		<variant>release:<location>$(DIST_RELEASE)/lib
		<install-type>LIB
	;
