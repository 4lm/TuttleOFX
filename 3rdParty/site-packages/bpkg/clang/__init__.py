#! /usr/bin/env python
'''\
clang description.
Template : v0.1\
'''
import sys

name       = 'clang'
if sys.platform == 'darwin':
    url        = 'http://llvm.org/releases/3.3/clang+llvm-3.3-x86_64-apple-darwin12.tar.gz'
    sha        = '6980f284489b070578096ec6662c930513b7d1e7'
    depends_on = []

else:
    raise NotImplementedError('url, sha and dependencies are not define '
                              'for platform {}.'.format(sys.platform))

def materialize(verbose=False, dry_run=False):
    '''
    Materialize the lib (archive, git repository ...)
    Hint: Make integrity check here.
    TODO: Put download function in bernardo.util
    '''
    def dl_progress(filename, count, block_size, total_size):
        '''
        TODO: put it in bernardo.util
        '''
        percent = int( count * block_size * 100/total_size )
        progress_bar = '[--------------------]'
        fill = ">" * (count * block_size * (len(progress_bar)-2)/total_size)
        progress_bar = progress_bar.replace('-'*len(fill), fill, 1)
        sys.stdout.write( '\r{} {} % of {}'.format(progress_bar,
                                                   percent, filename))
        sys.stdout.flush()

        if percent >= 100:
            sys.stdout.write('\n')
            sys.stdout.flush()

    report_hook = None
    if not verbose:
        report_hook = functools.partial(dl_progress, url)

    urllib.urlretrieve(lib.url, destination_filename, report_hook)
    #TODO checksum check
    #TODO decompress into install

def is_materialized():
    '''
    Return True if the lib is correctlky materialized,
    False otherwise.
    '''
    raise NotImplementedError()

def install():
    '''
    Install the lib (typically configure, make, make install)
    But since we can have strange birds on the internet, make
    everything necessary here.
    '''
    raise NotImplementedError()

def is_installed():
    '''
    Return True if the lib is installed
    False otherwise.
    '''
    raise NotImplementedError()

def clean():
    '''
    Clean the archive (reverse of the install function)
    '''
    raise NotImplementedError()

def distclean():
    '''
    Disclean the archive (clean + reverse of the materialize function)
    '''
    raise NotImplementedError()

def status():
    '''
    '''
    s = (__doc__  + "\n"
         "(" + sys.platform + ")\n" +
         "    name        = '{}'\n"
         "    url         = '{}'\n"
         "    sha         = '{}'\n"
         "    depends_on  = {}\n".format(name, url, sha, depends_on))
    
    return s

if __name__ == "__main__":
    sys.stdout.write(status())
